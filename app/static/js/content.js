// Content Manager
class ContentManager {
    constructor() {
        this.topics = [];
        this.content = [];
    }

    async loadTopics() {
        try {
            Utils.hideError();
            const headers = window.auth ? window.auth.getAuthHeaders() : {};
            this.topics = await Utils.apiCall('/api/v1/topics/', { headers });
            
            this.renderTopics();
        } catch (error) {
            console.error('Error loading topics:', error);
            Utils.setHTML('topics', '<p class="error">Failed to load topics</p>');
        }
    }

    async loadContent() {
        try {
            Utils.hideError();
            const headers = window.auth ? window.auth.getAuthHeaders() : {};
            this.content = await Utils.apiCall('/api/v1/content/', { headers });
            
            this.renderContent();
        } catch (error) {
            console.error('Error loading content:', error);
            Utils.setHTML('content', '<p class="error">Failed to load content</p>');
        }
    }

    renderTopics() {
        if (this.topics.length === 0) {
            Utils.setHTML('topics', '<p>No topics available</p>');
            return;
        }

        Utils.setHTML('topics', this.topics.map(topic => `
            <div class="topic-card">
                <h3>${topic.title}</h3>
                <p>${topic.description}</p>
                <p><strong>Category:</strong> ${topic.category}</p>
                <p><strong>Trend Score:</strong> ${topic.trend_score}</p>
            </div>
        `).join(''));
    }

    renderContent() {
        if (this.content.length === 0) {
            Utils.setHTML('content', '<p>No content available</p>');
            return;
        }

        Utils.setHTML('content', this.content.map(item => `
            <div class="content-item" onclick="window.sessionManager.trackContentView(${item.id})">
                <h4>${item.topic.title} - ${item.content_type}</h4>
                <p>${item.content_text.substring(0, 200)}...</p>
                <small>Generated by: ${item.ai_model_used}</small>
                <br><small><em>Click to track view</em></small>
            </div>
        `).join(''));
    }

    async refresh() {
        await Promise.all([
            this.loadTopics(),
            this.loadContent()
        ]);
    }
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet, noodp, noydir">
    <meta name="googlebot" content="noindex, nofollow">
    <meta name="bingbot" content="noindex, nofollow">
    <meta name="slurp" content="noindex, nofollow">
    <meta name="duckduckbot" content="noindex, nofollow">
    <title>Nexus Admin Panel</title>
    
    <!-- Immediate mode initialization to prevent flash - MUST be before CSS -->
    <script>
        (function() {
            // Only apply light mode if explicitly selected (dark mode is default)
            const savedPreference = localStorage.getItem('adminDarkMode');
            
            if (savedPreference === 'false') {
                // User explicitly selected light mode
                document.documentElement.classList.add('light-mode');
            }
            // No else needed - dark mode is default without any class
        })();
    </script>
    <style>
        /* Blocking inline styles to prevent flash - applied immediately */
        /* Set variables based on mode */
        html {
            --bg-primary: #181818;
            --bg-secondary: #222222;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #999999;
        }
        
        html.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
        }
        
        /* Apply variables to elements */
        html, body {
            background-color: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }
        /* Light mode (only when explicitly set) */
        html.light-mode {
            --bg-primary: #ffffff !important;
            --bg-secondary: #f5f5f5 !important;
            --bg-tertiary: #e0e0e0 !important;
            --text-primary: #333333 !important;
            --text-secondary: #666666 !important;
            --text-muted: #999999 !important;
        }
        html.light-mode,
        html.light-mode body {
            background-color: #ffffff !important;
            color: #333333 !important;
        }
    </style>
    
    <link rel="stylesheet" href="/static/css/admin.css?v=202511210200">
</head>
<body class="dark-mode">
    <div id="access-denied" class="access-denied hidden">
        <div class="access-denied-content">
            <h1>403</h1>
            <p>Access Denied</p>
        </div>
    </div>

    <div id="admin-content" class="hidden">
        <header class="admin-header">
            <div class="container">
                <h1>üîí Nexus Admin Panel</h1>
                <nav>
                    <span id="admin-welcome"></span>
                    <button id="dark-mode-toggle" onclick="toggleDarkMode()">üåô</button>
                    <button onclick="logout()">Logout</button>
                </nav>
            </div>
        </header>

        <main class="admin-main">
            <div class="container">
                <!-- Navigation Tabs -->
                <div class="admin-tabs">
                    <button class="tab-btn active" data-tab="tracking">üìä Interest Tracking</button>
                    <button class="tab-btn" data-tab="settings">‚öôÔ∏è Global Settings</button>
                    <button class="tab-btn" data-tab="users">üë• User Management</button>
                    <button class="tab-btn" data-tab="analytics">üìà Analytics</button>
                </div>

                <!-- Interest Tracking Tab -->
                <div id="tab-tracking" class="tab-content active">
                    <div class="section">
                        <h2>Real-Time Interest Tracking</h2>
                        <div class="controls">
                            <button onclick="refreshTracking()" class="btn-refresh">üîÑ Refresh</button>
                            <button onclick="clearTracking()" class="btn-clear">üóëÔ∏è Clear All</button>
                            <label>
                                <input type="checkbox" id="auto-refresh" checked> Auto-refresh (5s)
                            </label>
                        </div>
                        
                        <div class="stats-grid">
                            <div class="stat-card">
                                <h3>Total Events</h3>
                                <p class="stat-value" id="total-events">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>High Interest</h3>
                                <p class="stat-value high" id="high-interest">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Medium Interest</h3>
                                <p class="stat-value medium" id="medium-interest">0</p>
                            </div>
                            <div class="stat-card">
                                <h3>Low Interest</h3>
                                <p class="stat-value low" id="low-interest">0</p>
                            </div>
                        </div>

                        <div id="tracking-log" class="tracking-log"></div>
                    </div>
                </div>

                <!-- Global Settings Tab -->
                <div id="tab-settings" class="tab-content">
                    <div class="section">
                        <h2>Global Hover Tracking Settings</h2>
                        <p class="section-description">These settings apply to all users by default</p>
                        
                        <div class="settings-grid">
                            <div class="setting-group">
                                <label for="minHoverDuration">
                                    Minimum Hover Duration (ms)
                                    <span class="help-text">Minimum time to consider as interest</span>
                                </label>
                                <input type="number" id="minHoverDuration" value="1500" min="100" max="10000" step="100">
                            </div>

                            <div class="setting-group">
                                <label for="afkThreshold">
                                    AFK Threshold (ms)
                                    <span class="help-text">Time before marking user as inactive</span>
                                </label>
                                <input type="number" id="afkThreshold" value="5000" min="1000" max="30000" step="1000">
                            </div>

                            <div class="setting-group">
                                <label for="movementThreshold">
                                    Movement Threshold (px)
                                    <span class="help-text">Minimum movement to consider as active</span>
                                </label>
                                <input type="number" id="movementThreshold" value="5" min="1" max="50" step="1">
                            </div>

                            <div class="setting-group">
                                <label for="microMovementThreshold">
                                    Micro-Movement Threshold (px)
                                    <span class="help-text">Maximum distance for repositioning detection</span>
                                </label>
                                <input type="number" id="microMovementThreshold" value="20" min="5" max="100" step="5">
                            </div>

                            <div class="setting-group">
                                <label for="slowdownVelocityThreshold">
                                    Slowdown Velocity Threshold (px/ms)
                                    <span class="help-text">Velocity below which counts as slowdown</span>
                                </label>
                                <input type="number" id="slowdownVelocityThreshold" value="0.3" min="0.1" max="2.0" step="0.1">
                            </div>

                            <div class="setting-group">
                                <label for="velocitySampleRate">
                                    Velocity Sample Rate (ms)
                                    <span class="help-text">How often to check velocity</span>
                                </label>
                                <input type="number" id="velocitySampleRate" value="100" min="50" max="500" step="50">
                            </div>

                            <div class="setting-group">
                                <label for="interestScoreThreshold">
                                    Interest Score Threshold
                                    <span class="help-text">Minimum score to report interest</span>
                                </label>
                                <input type="number" id="interestScoreThreshold" value="50" min="10" max="100" step="5">
                            </div>

                            <div class="setting-group">
                                <label for="scrollSlowdownThreshold">
                                    Scroll Slowdown Threshold (px/ms)
                                    <span class="help-text">Scroll velocity indicating interest</span>
                                </label>
                                <input type="number" id="scrollSlowdownThreshold" value="2.0" min="0.5" max="10.0" step="0.5">
                            </div>
                        </div>

                        <div class="button-group">
                            <button onclick="saveGlobalSettings()" class="btn-primary">üíæ Save Global Settings</button>
                            <button onclick="resetToDefaults()" class="btn-secondary">üîÑ Reset to Defaults</button>
                            <button onclick="testSettings()" class="btn-secondary">üß™ Test Settings</button>
                        </div>
                    </div>
                </div>

                <!-- User Management Tab -->
                <div id="tab-users" class="tab-content">
                    <div class="section">
                        <h2>User Management & Per-User Settings</h2>
                        
                        <div class="controls">
                            <input type="text" id="user-search" placeholder="üîç Search users..." onkeyup="filterUsers()">
                            <button onclick="refreshUsers()" class="btn-refresh">üîÑ Refresh Users</button>
                        </div>

                        <div id="users-list" class="users-list"></div>
                    </div>
                </div>

                <!-- Analytics Tab -->
                <div id="tab-analytics" class="tab-content">
                    <div class="section">
                        <h2>Analytics Dashboard</h2>
                        
                        <div class="date-range">
                            <label>Date Range:</label>
                            <input type="date" id="start-date" aria-label="Start date">
                            <input type="date" id="end-date" aria-label="End date">
                            <button onclick="loadAnalytics()" class="btn-primary">Load Data</button>
                        </div>

                        <div class="analytics-grid">
                            <div class="chart-card">
                                <h3>Interest Distribution</h3>
                                <canvas id="interest-chart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3>Top Content</h3>
                                <div id="top-content"></div>
                            </div>
                            <div class="chart-card">
                                <h3>User Engagement Timeline</h3>
                                <canvas id="timeline-chart"></canvas>
                            </div>
                            <div class="chart-card">
                                <h3>Hover Patterns</h3>
                                <div id="hover-patterns"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- User Settings Modal -->
    <div id="user-settings-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeUserModal()">&times;</button>
            <h2>User Settings: <span id="modal-username"></span></h2>
            
            <div class="modal-section">
                <h3>Debug Mode</h3>
                <label class="debug-mode-label">
                    <input type="checkbox" id="user-debug-mode" class="debug-mode-checkbox">
                    <div>
                        <div class="debug-mode-title">Enable Debug Mode</div>
                        <div class="debug-mode-description">
                            Shows interest scores on cards and enables console logging for this user
                        </div>
                    </div>
                </label>
                <div id="debug-warning" class="debug-warning hidden">
                    ‚ö†Ô∏è Debug mode is ENABLED. User will see interest tracking data on their feed.
                </div>
            </div>

            <div class="modal-section">
                <h3>Custom Hover Tracking Settings</h3>
                <label>
                    <input type="checkbox" id="user-use-custom"> Use custom settings for this user
                </label>
                
                <div id="user-custom-settings" class="settings-grid hidden">
                    <div class="setting-group">
                        <label for="user-minHoverDuration">Min Hover Duration (ms)</label>
                        <input type="number" id="user-minHoverDuration" value="1500">
                    </div>
                    <div class="setting-group">
                        <label for="user-afkThreshold">AFK Threshold (ms)</label>
                        <input type="number" id="user-afkThreshold" value="5000">
                    </div>
                    <div class="setting-group">
                        <label for="user-interestScoreThreshold">Interest Score Threshold</label>
                        <input type="number" id="user-interestScoreThreshold" value="50">
                    </div>
                </div>
            </div>

            <div class="modal-section">
                <h3>User Statistics</h3>
                <div id="user-stats"></div>
            </div>

            <div class="button-group">
                <button onclick="saveUserSettings()" class="btn-primary">üíæ Save Settings</button>
                <button onclick="closeUserModal()" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="/static/js/admin.js?v=202511210200"></script>
</body>
</html>

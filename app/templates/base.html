<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NCNEQG70WC"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-NCNEQG70WC');
    </script>

    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1529513529221142"
        crossorigin="anonymous"></script>

    <title>{% block title %}Nexus - The AI News Portal{% endblock %}</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">

    <!-- Immediate mode initialization to prevent flash - MUST be before CSS -->
    <script>
        (function () {
            // Check localStorage for saved preference, default to dark mode
            const savedPreference = localStorage.getItem('darkMode');
            const shouldBeLight = savedPreference === 'false';
            if (shouldBeLight) {
                document.documentElement.classList.add('light-mode');
            }
        })();
    </script>
    <style>
        /* Blocking inline styles to prevent flash - applied immediately */
        /* Dark mode (default) - only when NOT light mode */
        html:not(.light-mode),
        html:not(.light-mode) body {
            --bg-primary: #181818;
            --bg-secondary: #222222;
            --bg-tertiary: #2a2a2a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --text-muted: #999999;
        }

        /* Light mode (only when explicitly set) */
        html.light-mode {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --text-muted: #999999;
        }

        html.light-mode,
        html.light-mode body {
            background-color: #ffffff !important;
            color: #333333 !important;
        }
    </style>

    <!-- Base CSS -->
    <link rel="stylesheet" href="/static/css/base.css?v=202512060200">
    <link rel="stylesheet" href="/static/css/header.css?v=202512060200">
    <link rel="stylesheet" href="/static/css/components.css?v=202512060200">

    <!-- Page-specific CSS -->
    {% block extra_css %}{% endblock %}
</head>
<body{% if body_class %} class="{{ body_class }}" {% endif %}>
    <!-- SHARED HEADER - Edit once, applies everywhere -->
    <header class="main-header">
        <div class="container">
            <a href="/" class="header-title-link">
                <h1><img src="/static/favicon.png" alt="Nexus Logo" class="site-logo"> Nexus - The Ai News Portal</h1>
            </a>
            <nav>
                <span id="user-welcome" class="user-welcome"></span>

                <!-- Desktop auth buttons (outside hamburger menu) -->
                <div class="header-auth-buttons">
                    <a href="/login" class="header-btn" id="auth-btn"><span class="menu-icon">üîê</span><span
                            class="menu-label">Login</span></a>
                    <a href="/register" class="header-btn" id="register-btn"><span class="menu-icon">üìù</span><span
                            class="menu-label">Register</span></a>
                </div>

                <button class="hamburger" id="hamburger-menu" aria-label="Open menu">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
                <div class="nav-links" id="nav-links">
                    <a href="/" class="menu-quick"><span class="menu-icon">üè†</span><span
                            class="menu-label">Feed</span></a>
                    <button id="dark-mode-toggle-menu"><span class="menu-icon">üåô</span><span class="menu-label">Dark
                            Mode</span></button>
                    <a href="/settings" class="menu-quick"><span class="menu-icon">‚öôÔ∏è</span><span
                            class="menu-label">Settings</span></a>

                    <!-- Mobile auth buttons (inside hamburger menu) -->
                    <a href="/login" class="auth-btn-mobile" id="auth-btn-mobile"><span class="menu-icon">üîê</span><span
                            class="menu-label">Login</span></a>
                    <a href="/register" class="auth-btn-mobile" id="register-btn-mobile"><span
                            class="menu-icon">üìù</span><span class="menu-label">Register</span></a>

                    <!-- Text size controls -->
                    <div class="text-size-controls">
                        <button id="text-size-decrease" class="text-size-btn" aria-label="Decrease text size">-</button>
                        <span class="text-size-label">
                            <span class="text-size-line1">Text</span>
                            <span class="text-size-line2">Size</span>
                        </span>
                        <button id="text-size-increase" class="text-size-btn" aria-label="Increase text size">+</button>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Page content -->
    {% block content %}{% endblock %}

    <!-- Shared Header Modules (loaded in order) -->
    <script src="/static/js/HeaderAuth.js?v=202512060200"></script>
    <script src="/static/js/HeaderDarkMode.js?v=202512060200"></script>
    <script src="/static/js/HeaderMenu.js?v=202512060200"></script>
    <script src="/static/js/HeaderPreferences.js?v=202512060200"></script>
    <script src="/static/js/HeaderSession.js?v=202512060200"></script>

    <!-- Page-specific scripts -->
    {% block extra_js %}{% endblock %}
    </body>

</html>
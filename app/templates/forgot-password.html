{% extends "base.html" %}

{% block title %}Forgot Password - Nexus{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/staticP2512071706">
{% endblock %}

{% block body_class %}forgot-password-page{% endblock %}

{% block content %}
<div class="login-container">
    <h2>Reset Password</h2>
    <p class="forgot-password-subtitle">Enter your username or email address and we'll send you a link to reset your password</p>
    <form id="forgot-password-form">
        <div class="form-row form-row-inline form-row-align">
            <label for="username-or-email">Username or Email</label>
            <input type="text" id="username-or-email" name="username_or_email" required autocomplete="username">
        </div>
        <div id="forgot-password-error" class="login-error"></div>
        <div id="forgot-password-success" class="login-success"></div>
        <div class="login-btn-row">
            <button type="submit" class="login-btn">Send Reset Link</button>
            <button type="button" class="register-btn" onclick="window.location.href='/login'">Back to Login</button>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgot-password-form');
    const errorDiv = document.getElementById('forgot-password-error');
    const successDiv = document.getElementById('forgot-password-success');
    const input = document.getElementById('username-or-email');

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        // Clear previous messages
        errorDiv.style.display = 'none';
        errorDiv.textContent = '';
        successDiv.style.display = 'none';
        successDiv.textContent = '';
        input.classList.remove('flash-error', 'flash-success');
        
        const usernameOrEmail = input.value;
        
        try {
            const response = await fetch('/api/v1/auth/forgot-password', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username_or_email: usernameOrEmail })
            });
            
            if (response.ok) {
                input.classList.add('flash-success');
                successDiv.textContent = 'If that account exists, we\'ve sent a password reset link to the registered email.';
                successDiv.style.display = 'block';
                form.reset();
            } else {
                const error = await response.json();
                input.classList.add('flash-error');
                errorDiv.textContent = error.detail || 'An error occurred. Please try again.';
                errorDiv.style.display = 'block';
            }
        } catch (error) {
            input.classList.add('flash-error');
            errorDiv.textContent = 'Network error. Please try again.';
            errorDiv.style.display = 'block';
        }
    });
});
</script>
{% endblock %}
